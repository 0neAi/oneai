<!-- Updated index.html -->
<!DOCTYPE HTML>
<html>
<head>
    <title>1Ai</title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
    <link rel="stylesheet" href="./assets/css/main.css">
</head>
<body class="is-preload">

    <!-- Header -->
    <header id="header">
        <h1>Welcome To 1Ai</h1>
        <p>We Provide Secured AI Services With Quality<br>
        by <a href="">One1ai</a>.</p>
    </header>

    <section>
        <h2>Secure Registration</h2>
        <form id="registerForm">
            <input type="tel" id="phone" placeholder="Phone Number" required pattern="[0-9]{11}"/><br>
            <input type="email" id="email" placeholder="Email" required /><br>
            <input type="password" id="password" placeholder="Password" required minlength="8" /><br>
            <button type="submit">Register Securely</button>
        </form>
        <p id="message" class="auth-message"></p>
        <a href="login.html">Already Have an account? Secure Login</a>
    </section>

    <script>
        document.getElementById('registerForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const formData = {
                phone: document.getElementById('phone').value,
                email: document.getElementById('email').value,
                password: document.getElementById('password').value
            };

            try {
                const response = await fetch('https://oneai-u23h.onrender.com/register', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(formData)
                });

                const data = await response.json();
                
                if (response.ok) {
                    // Store both userID and JWT token
                    localStorage.setItem('userID', data.userID);
                    localStorage.setItem('authToken', data.token);
                    localStorage.setItem('tokenExp', data.expiresIn);
                    
                    window.location.href = 'dashboard.html';
                } else {
                    document.getElementById('message').innerText = data.message || 'Registration failed';
                }
            } catch (error) {
  document.getElementById('message').innerText = `Error: ${error.message}`;
}
        });

        // Session validation on load
        document.addEventListener('DOMContentLoaded', async () => {
            const token = localStorage.getItem('authToken');
            const userID = localStorage.getItem('userID');
            
            if (token && userID) {
                try {
                    const validation = await fetch(`https://oneai-u23h.onrender.com/validate`, {
                        headers: {
                            'Authorization': `Bearer ${token}`,
                            'X-User-ID': userID
                        }
                    });
                    
                    if (!validation.ok) throw new Error('Invalid session');
                    window.location.href = 'dashboard.html';
                } catch (error) {
                    localStorage.clear();
                }
            }
        });
    </script>

    <script src="./assets/js/main.js"></script>
    <script src="./assets/js/load-navbar.js"></script>
</body>
</html>
