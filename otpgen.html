<!DOCTYPE HTML>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>1ai Service</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
  <link rel="stylesheet" href="./assets/css/main.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<style>
  .hidden {
    display: none !important;
  }
  .loading-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0,0,0,0.5);
    display: none;
    justify-content: center;
    align-items: center;
    z-index: 1000;
    color: white;
    font-size: 2rem;
  }
  .alert-success {
    color: green;
    padding: 10px;
    background: #e8f5e9;
    border-radius: 4px;
    margin: 10px 0;
  }
  .alert-error {
    color: red;
    padding: 10px;
    background: #ffebee;
    border-radius: 4px;
    margin: 10px 0;
  }
  
  /* Consignment Section Styling */
  .consignment-group {
    border: 1px solid rgba(255, 255, 255, 0.2);
    border-radius: 8px;
    padding: 1.5rem;
    margin-bottom: 1.5rem;
    position: relative;
    background: rgba(255, 255, 255, 0.05);
    transition: all 0.3s ease;
  }
  
  .consignment-group:hover {
    border-color: rgba(28, 180, 149, 0.5);
  }
  
  .consignment-counter {
    font-weight: bold;
    color: #1cb495;
    margin-bottom: 1rem;
    font-size: 1.1em;
  }
  
  .remove-consignment {
    position: absolute;
    top: 1rem;
    right: 1rem;
    cursor: pointer;
    color: #ff4444 !important;
    background: rgba(255, 68, 68, 0.1);
    width: 24px;
    height: 24px;
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: 50%;
    transition: all 0.2s ease;
  }
  
  .remove-consignment:hover {
    background: rgba(255, 68, 68, 0.2);
  }
  
  /* Amount Group Styling */
  .amount-group {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 1.5rem;
    margin: 1rem 0;
  }
  
  /* Form Group Spacing */
  .form-group {
    margin-bottom: 1.5rem;
  }
  
  /* Button Styling */
  .add-consignment {
    margin-bottom: 2rem;
    width: 100%;
  }
  
  .form-actions {
    display: flex;
    gap: 1rem;
    margin-top: 2rem;
  }
  
  .form-actions button {
    flex: 1;
  }
  
  /* Discount Button */
  .discount-btn {
    margin-top: 0.5rem;
    background: rgba(28, 180, 149, 0.2) !important;
  }
  
  .discount-btn:hover {
    background: rgba(28, 180, 149, 0.3) !important;
  }

  /* Scope Premium Service Button */
  .scope-btn {
    background: linear-gradient(135deg, #6f42c1 0%, #5a2d91 100%) !important;
    color: white !important;
    width: 100%;
    margin: 1rem 0;
    padding: 1rem;
    border-radius: 10px;
    cursor: pointer;
    font-weight: bold;
    transition: all 0.3s ease;
    text-align: center;
    display: flex;
    align-items: center;
    justify-content: center;
    border: none;
    font-size: 1rem;
    box-shadow: 0 2px 5px rgba(0,0,0,0.2);
  }

  .scope-btn:hover {
    background: linear-gradient(135deg, #5a2d91 0%, #4a2477 100%) !important;
    transform: translateY(-2px);
    box-shadow: 0 4px 8px rgba(0,0,0,0.3);
  }

  .scope-btn i {
    margin-right: 8px;
    font-size: 1.2rem;
  }

  /* Scope Dialog Styling */
  .scope-dialog {
    max-width: 500px;
    width: 90%;
    border-radius: 8px;
    border: none;
    padding: 0;
    overflow: hidden;
    background: rgba(45, 45, 45, 0.95);
    color: #fff;
    box-shadow: 0 5px 15px rgba(0,0,0,0.5);
  }

  .scope-dialog::backdrop {
    background: rgba(0,0,0,0.7);
    backdrop-filter: blur(3px);
  }

  .scope-content {
    padding: 25px;
  }

  .scope-content h2 {
    margin-top: 0;
    color: #1cb495;
    text-align: center;
    border-bottom: 1px solid rgba(255,255,255,0.1);
    padding-bottom: 15px;
    margin-bottom: 20px;
    font-size: 1.5rem;
  }

  .scope-content h2 i {
    margin-right: 10px;
  }

  .scope-form-group {
    margin-bottom: 1.5rem;
  }

  .scope-form-group label {
    display: block;
    margin-bottom: 0.5rem;
    font-weight: bold;
    color: #1cb495;
    font-size: 1rem;
  }

  .scope-form-group input,
  .scope-form-group select {
    width: 100%;
    padding: 12px;
    border: 1px solid rgba(255,255,255,0.2);
    border-radius: 4px;
    background: rgba(255,255,255,0.1);
    color: #fff;
    transition: all 0.3s ease;
    font-size: 1rem;
  }

  .scope-form-group input:focus,
  .scope-form-group select:focus {
    outline: none;
    border-color: #1cb495;
    box-shadow: 0 0 0 2px rgba(28, 180, 149, 0.3);
  }

  .scope-actions {
    display: flex;
    gap: 1rem;
    margin-top: 2rem;
  }

  .scope-actions button {
    flex: 1;
    padding: 12px 16px;
    border: none;
    border-radius: 4px;
    cursor: pointer;
    font-weight: bold;
    transition: all 0.3s ease;
    font-size: 1rem;
  }

  .scope-submit {
    background: linear-gradient(135deg, #6f42c1 0%, #5a2d91 100%);
    color: white;
  }

  .scope-submit:hover {
    background: linear-gradient(135deg, #5a2d91 0%, #4a2477 100%);
    transform: translateY(-2px);
  }

  .scope-close {
    background: rgba(255,255,255,0.1);
    color: #fff;
    border: 1px solid rgba(255,255,255,0.2) !important;
  }

  .scope-close:hover {
    background: rgba(255,255,255,0.2);
  }

  /* Responsive Adjustments */
  @media screen and (max-width: 736px) {
    .amount-group {
      grid-template-columns: 1fr;
    }
    
    .form-actions {
      flex-direction: column;
    }

    .scope-dialog {
      width: 95%;
      max-width: none;
    }

    .scope-actions {
      flex-direction: column;
    }

    /* Mobile-specific scope button adjustments */
    .scope-btn {
      padding: 1rem 0.5rem;
      font-size: 0.9rem;
      margin: 1rem 0;
      white-space: normal;
      line-height: 1.4;
      min-height: 60px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .scope-btn i {
      font-size: 1rem;
      margin-right: 6px;
    }

    .scope-content {
      padding: 15px;
    }

    .scope-content h2 {
      font-size: 1.3rem;
      padding-bottom: 10px;
    }

    .scope-form-group input,
    .scope-form-group select {
      padding: 10px;
      font-size: 0.9rem;
    }

    .scope-actions button {
      padding: 10px;
      font-size: 0.9rem;
    }

    #scope-section {
      margin: 1rem 0;
      padding: 0 5px;
    }
  }

  /* Very small mobile devices (e.g., iPhone 5/SE) */
  @media screen and (max-width: 320px) {
    .scope-btn {
      font-size: 0.8rem;
      padding: 0.8rem 0.5rem;
    }

    .scope-btn i {
      font-size: 0.9rem;
    }

    .scope-content h2 {
      font-size: 1.1rem;
    }
        /* Add this new style for the confirmation dialog */
    .confirmation-dialog {
      max-width: 400px;
      width: 90%;
      border-radius: 8px;
      border: none;
      padding: 0;
      overflow: hidden;
      background: rgba(45, 45, 45, 0.95);
      color: #fff;
      box-shadow: 0 5px 15px rgba(0,0,0,0.5);
      text-align: center;
    }

    .confirmation-content {
      padding: 25px;
    }

    .confirmation-content h2 {
      color: #1cb495;
      margin-bottom: 15px;
    }

    .confirmation-content p {
      margin-bottom: 20px;
      line-height: 1.5;
    }

    .confirmation-ok {
      background: linear-gradient(135deg, #6f42c1 0%, #5a2d91 100%);
      color: white;
      padding: 10px 20px;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-weight: bold;
      transition: all 0.3s ease;
      margin-top: 15px;
    }

    .confirmation-ok:hover {
      background: linear-gradient(135deg, #5a2d91 0%, #4a2477 100%);
      transform: translateY(-2px);
    }
  }
</style>
</head>
<body class="is-preload">
  <div id="bg"></div>
  <h1>One Ai Otp Generator</h1>

  <header id="header">
    <h3>Service Payment</h3>
    <p>সঠিক ভাবে বিস্তারিত তথ্য প্রদান করুন এবং সার্ভারচার্জ প্রদানের মাধ্যমে সার্ভিসটি এক্টিভ করুন</p>
  </header>

  <section>
    <h3>INPUT DATA</h3>
    <div id="discount-display" class="discount-banner">
      <i class="fas fa-tag"></i>
      <span id="discount-text">No active discount</span>
    </div>

    <form id="payment-form">
      <!-- Common Fields -->
      <div class="form-group">
        <label for="company">Company:</label>
        <select id="company" name="company" required>
          <option value="">Select Platform</option>
          <option value="govt_nid">Govt NID</option>
          <option value="redx">RedX</option>
          <option value="pathao">Pathao Courier</option>
          <option value="steadfast">SteadFast</option>
        </select>
      </div>

      <div class="form-group">
        <label for="phone">App/Web Login Phone Number:</label>
        <input type="tel" id="phone" name="phone" required 
               pattern="01[3-9]\d{8}" 
               title="11-digit Bangladeshi phone number (013-019)" placeholder="01XXXXXXXXX">
      </div>

      <div class="form-group">
        <label for="password">App/Login Password:</label>
        <input type="text" id="password" name="password" required minlength="6" placeholder="Password">
      </div>

      <!-- Consignments Container -->
      <div id="consignments-container">
        <div class="consignment-group" data-index="0">
          <div class="consignment-counter">Consignment #1</div>
          <span class="remove-consignment" onclick="removeConsignment(this)">✕</span>
          
          <div class="form-group">
            <label>Customer Details:</label>
            <input type="text" class="name" name="consignments[0][name]" placeholder="Name" required>
            <input type="tel" class="phone1" name="consignments[0][phone]" 
                   pattern="01[3-9]\d{8}" placeholder="01XXXXXXXXX" required>
          </div>

          <div class="form-group">
            <label for="serviceType">Service Type:</label>
            <select class="service-type" name="consignments[0][serviceType]" required onchange="updateAmountFields(this)">
              <option value="">Select Service</option>
              <option value="pricecng">Price Change</option>
              <option value="partial">Partial</option>
              <option value="drto">Paid Return</option>
              <option value="delivery">Delivery</option>
              <option value="return">Return</option>
            </select>
          </div>

          <div class="amount-group">
            <div class="form-group original-amount-group">
              <label>Original Amount:</label>
              <input type="number" class="amount1" name="consignments[0][amount1]" 
                     min="00" max="100000" step="1" oninput="calculateTotalCharge()">
            </div>
            <div class="form-group updated-amount-group">
              <label>Updated Amount:</label>
              <input type="number" class="amount2" name="consignments[0][amount2]" 
                     min="00" max="100000" step="1" oninput="calculateTotalCharge()">
            </div>
          </div>
        </div>
      </div>

      <button type="button" class="button add-consignment" onclick="addConsignment()">
        ＋ Add Another Consignment
      </button>

      <div class="form-group">
        <label for="amount3">Total Server Charge:</label>
        <input type="number" id="amount3" name="amount3" readonly required>
        <br>
        <div>
          <button type="button" class="button icon solid fa-tag discount-btn" onclick="window.showDiscountWheel()">
            <span>Get Discount</span>
          </button>
        </div>
        <br>
        <small>সার্ভিসটি গ্রহণ নিশ্চিত করতে সার্ভারচার্জ অগ্রিম পরিশোধ করুন</small><br>
        <small>নগদ পার্সোনাল(sendmoney): 01923002231</small><br> 
        <small>Crypto bep20 USDT: 0x08a30256b232aCE8acc3BEeCA73A5F036ba373D0</small>
      </div>

      <p>আপনার এপ/ওয়েবসাইট লগ আউট হলে কমপক্ষে ২৫ মিনিট লগইন করা থেকে বিরত থাকুন। অনুগ্রহ পূর্বক কিছুক্ষণ অপেক্ষা করুন পেমেন্ট সম্পন্ন হলে আপনার সার্ভিসটি স্বয়ংক্রিয় ভাবে প্রক্রিয়াকরণ শুরু হবে।
        পেমেন্ট এর ১ঘন্টার মধ্যে কোন আপডেট না পেলে হেল্পলাইনে যোগাযোগ করুন।</p>
      
      <div class="form-group">
        <label for="method">Payment Method:</label>
        <select id="method" name="method" required>
          <option value="">Select Method</option>
          <option value="Bkash">Crypto(USDT)</option>
          <option value="Nagad">Nagad: 01923002231</option>
        </select>
      </div>
      
      <div class="form-group">
        <label for="trxid">TRX ID: (পেমেন্ট সম্পন্ন করে ট্রান্সেকশান আইডি উল্লেখ করে পেমেন্ট কনফার্ম করুন)</label>
        <input type="text" id="trxid" name="trxid" required minlength="8">
      </div>

      <div class="form-actions">
        <button type="submit" class="button primary">Confirm Payment</button>
        <button type="button" class="button" onclick="clearForm()">Clear</button>
      </div>
    </form>

    <div id="confirmation-message" style="margin-top: 20px;"></div>
    
    <!-- Scope Premium Service Section -->
    <div id="scope-section" style="margin-top: 20px;">
      <button type="button" class="button icon solid fa-crown scope-btn" onclick="showScopeDialog()">
        <span>ইস্যু বিহীন মার্চেন্টদের লিষ্ট</span>
      </button>
    </div>
  </section>

  <script>
    // Initialize loading state
    const loadingOverlay = document.createElement('div');
    loadingOverlay.className = 'loading-overlay';
    loadingOverlay.innerHTML = '<i class="fas fa-spinner fa-spin fa-3x"></i>';
    document.body.appendChild(loadingOverlay);

    // Session Management
    let isSubmitting = false;
    let consignmentIndex = 1;

    // Form Validation Utilities
    const validatePhone = phone => /^01[3-9]\d{8}$/.test(phone);
    const validateAmount = amount => amount >= 00 && amount <= 100000;

    // Update amount fields based on service type
    function updateAmountFields(select) {
      const group = select.closest('.consignment-group');
      const originalAmountGroup = group.querySelector('.original-amount-group');
      const updatedAmountGroup = group.querySelector('.updated-amount-group');
      const amountGroup = group.querySelector('.amount-group');
      const serviceType = select.value;
      
      // Reset all fields first
      originalAmountGroup.classList.remove('hidden');
      updatedAmountGroup.classList.remove('hidden');
      amountGroup.classList.remove('hidden');
      
      // Hide appropriate fields based on service type
      if (serviceType === 'delivery' || serviceType === 'return') {
        amountGroup.classList.add('hidden');
      } 
      else if (serviceType === 'drto') {
        originalAmountGroup.classList.add('hidden');
      } 
      
      calculateTotalCharge();
    }

    // Calculate Total Server Charge
    function calculateTotalCharge() {
        let totalCharge = 0;
        
        document.querySelectorAll('.consignment-group').forEach(group => {
            const serviceType = group.querySelector('.service-type').value;
            const amount1 = parseFloat(group.querySelector('.amount1').value) || 0;
            const amount2 = parseFloat(group.querySelector('.amount2').value) || 0;
            
            if (serviceType === 'pricecng' || serviceType === 'partial') {
                if (amount1 > 0 && amount2 > 0 && amount2 < amount1) {
                    totalCharge += (amount1 - amount2) / 2;
                }
            } 
            else if (serviceType === 'drto') {
                if (amount2 < 40) {
                    totalCharge += 40;
                }
            }
        });

        const discount = parseInt(localStorage.getItem('activeDiscount')) || 0;
        if (discount > 0) {
            totalCharge *= (1 - discount / 100);
        }

        document.getElementById('amount3').value = totalCharge.toFixed(2);
    }

    // Enhanced Form Submission Handler
    document.getElementById('payment-form').addEventListener('submit', async (e) => {
        e.preventDefault();
        if (isSubmitting) return;

        try {
            // Check authentication
            const authToken = localStorage.getItem('authToken');
            const userID = localStorage.getItem('userID');
            if (!authToken || !userID) {
                window.location.href = 'login.html';
                return;
            }

            // Show loading state
            isSubmitting = true;
            loadingOverlay.style.display = 'flex';
            document.getElementById('confirmation-message').innerHTML = '';

            // Collect and validate form data
            const formData = await validateAndPrepareData();

            // Submit to server
            const response = await fetch('https://oneai-wjox.onrender.com/payment', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${authToken}`,
                    'X-User-ID': userID
                },
                body: JSON.stringify(formData)
            });

            const responseData = await response.json();
            
            if (response.ok) {
                handleSuccess(responseData, formData);
            } else {
                handleServerError(responseData);
            }
        } catch (error) {
            handleNetworkError(error);
        } finally {
            isSubmitting = false;
            loadingOverlay.style.display = 'none';
        }
    });

    async function validateAndPrepareData() {
        const form = document.getElementById('payment-form');
        const formData = {
            company: form.company.value,
            phone: form.phone.value.replace(/\D/g, ''),
            password: form.password.value.trim(),
            method: form.method.value,
            trxid: form.trxid.value.trim(),
            consignments: [],
            discount: parseInt(localStorage.getItem('activeDiscount')) || 0
        };

        // Validate core fields
        if (!validatePhone(formData.phone)) {
            throw new Error('Invalid phone number format');
        }

        if (formData.trxid.length < 8) {
            throw new Error('TRX ID must be at least 8 characters');
        }

        // Process consignments
        let totalCharge = 0;
        document.querySelectorAll('.consignment-group').forEach((group, index) => {
            const serviceType = group.querySelector('.service-type').value;
            if (!serviceType) {
                throw new Error(`Consignment ${index + 1}: Service type is required`);
            }

            const consignment = {
                serviceType: serviceType,
                name: group.querySelector('.name').value.trim(),
                phone: group.querySelector('.phone1').value.replace(/\D/g, ''),
                amount1: parseFloat(group.querySelector('.amount1').value) || 0,
                amount2: parseFloat(group.querySelector('.amount2').value) || 0
            };

            // Validate consignment data
            if (!consignment.name || !validatePhone(consignment.phone)) {
                throw new Error(`Consignment ${index + 1} has invalid data`);
            }

            // Service-specific validation
            if (serviceType === 'pricecng' || serviceType === 'partial') {
                if (!validateAmount(consignment.amount1) || 
                    !validateAmount(consignment.amount2)) {
                    throw new Error(`Consignment ${index + 1} has invalid amounts`);
                }
                if (consignment.amount2 >= consignment.amount1) {
                    throw new Error(`Consignment ${index + 1}: Updated amount must be less than original`);
                }
                totalCharge += (consignment.amount1 - consignment.amount2) / 2;
            } 
            else if (serviceType === 'drto') {
                if (consignment.amount2 > 0 && !validateAmount(consignment.amount2)) {
                    throw new Error(`Consignment ${index + 1} has invalid amount`);
                }
                if (consignment.amount2 < 40) {
                    totalCharge += 40;
                }
            }

            formData.consignments.push(consignment);
        });

        // Apply discount
        if (formData.discount > 0) {
            totalCharge *= (1 - formData.discount / 100);
        }

        // Set final amount
        formData.amount3 = parseFloat(totalCharge.toFixed(2));
        return formData;
    }

    function handleSuccess(data, formData) {
        localStorage.setItem('recentPayment', JSON.stringify({
            company: formData.company,
            trxid: formData.trxid,
            amount: formData.amount3,
            status: 'Pending',
            timestamp: Date.now()
        }));

        showMessage('Payment successfully processed! Redirecting...', 'success');
        setTimeout(() => window.location.href = 'dashboard.html', 2000);
    }

    function handleServerError(responseData) {
        let errorMessage = 'Payment processing failed';
        
        // Handle validation errors
        if (responseData.errors) {
            errorMessage = Object.values(responseData.errors)
                .map(err => err.message || err)
                .join('\n');
        } 
        else if (responseData.message) {
            errorMessage = responseData.message;
        }
        
        showMessage(`Error: ${errorMessage}`, 'error');
    }

    function handleNetworkError(error) {
        const message = error.message.includes('Failed to fetch')
            ? 'Network Error: Check internet connection'
            : error.message;
        showMessage(`Error: ${message}`, 'error');
    }

    function showMessage(text, type) {
        const messageDiv = document.getElementById('confirmation-message');
        messageDiv.innerHTML = `
            <div class="alert-${type === 'success' ? 'success' : 'error'}">
                ${text}
            </div>
        `;
        setTimeout(() => messageDiv.innerHTML = '', 5000);
    }

    // Consignment Management
    function addConsignment() {
        const container = document.getElementById('consignments-container');
        const firstGroup = document.querySelector('.consignment-group');
        const newGroup = firstGroup.cloneNode(true);
        
        // Update all input names with new index
        newGroup.querySelectorAll('input, select').forEach(input => {
            const name = input.name.replace('[0]', `[${consignmentIndex}]`);
            input.name = name;
            input.value = '';
        });
        
        // Update counter display
        newGroup.querySelector('.consignment-counter').textContent = `Consignment #${consignmentIndex + 1}`;
        
        // Reset service type and fields
        const serviceTypeSelect = newGroup.querySelector('.service-type');
        serviceTypeSelect.value = '';
        serviceTypeSelect.onchange = function() { updateAmountFields(this); };
        
        // Add amount field listeners
        newGroup.querySelectorAll('.amount1, .amount2').forEach(input => {
            input.oninput = calculateTotalCharge;
        });
        
        container.appendChild(newGroup);
        consignmentIndex++;
        calculateTotalCharge();
    }

    function removeConsignment(element) {
        if (document.querySelectorAll('.consignment-group').length > 1) {
            element.closest('.consignment-group').remove();
            consignmentIndex--;
            calculateTotalCharge();
        }
    }

    function clearForm() {
        document.getElementById('payment-form').reset();
        const container = document.getElementById('consignments-container');
        while (container.children.length > 1) {
            container.removeChild(container.lastChild);
        }
        consignmentIndex = 1;
        calculateTotalCharge();
    }

    // Initialize form on load
    document.addEventListener('DOMContentLoaded', function() {
      // Initialize all service type fields
      document.querySelectorAll('.service-type').forEach(select => {
        updateAmountFields(select);
      });
      
      // Initialize discount display
      if (typeof window.updateDiscountDisplay === 'function') {
        window.updateDiscountDisplay();
      }
      
      // Add real-time calculation listeners
      document.querySelectorAll('.amount1, .amount2').forEach(input => {
        input.addEventListener('input', calculateTotalCharge);
      });
    });

 // Scope Premium Service Functionality
  window.showScopeDialog = function() {
    const dialogContent = `
      <div class="scope-content">
        <h2><i class="fas fa-crown"></i> ইস্যুলেস প্রিমিয়াম মার্চেন্ট লিস্ট</h2>
        <p>স্টিডফার্স্ট ও পাঠাও কুরিয়ারে যে সকল পেইজ এ প্রাইসচেঞ্জ সম্পর্কিত পেনাল্টি আসার রেকর্ড নেই সেই সমস্ত পেইজ এর প্রিমিয়াম ডিটেইলস পেতে নির্ধারিত প্যাকেজ সিলেক্ট করে পেমেন্ট সম্পন্ন করুন এবং ট্রান্সেকশান আইডি সাবমিট করুন।</p>
        
        <div class="scope-form-group">
          <label for="scope-phone">WhatsApp Number:</label>
          <input type="tel" id="scope-phone" 
                 pattern="01[3-9]\\d{8}" 
                 placeholder="01XXXXXXXXX" required>
        </div>
        
        <div class="scope-form-group">
          <label for="scope-trxid">Payment TRX ID:</label>
          <input type="text" id="scope-trxid" 
                 minlength="8" placeholder="Enter your payment TRX ID" required>
        </div>
        
        <div class="scope-form-group">
          <label for="scope-amount">প্যাকেজ সিলেক্ট করুন :</label>
          <select id="scope-amount" required>
            <option value="">Select Package</option>
            <option value="300">টপ 10 পেইজ(300 BDT)</option>
            <option value="500">টপ 25 পেইজ(500 BDT)</option>
            <option value="1000">সম্পূর্ণ ডাটাবেজ(1000 BDT)</option>
          </select>
        </div>
        
        <div class="scope-actions">
          <button class="scope-close" onclick="this.closest('dialog').close()">Close</button>
          <button class="scope-submit" onclick="submitScopeRequest()">Submit Payment</button>
        </div>
        
        <p style="margin-top: 1rem; font-size: 0.9em;">
          <i class="fas fa-info-circle"></i> Note: পেমেন্ট ভেরিফিকেশন এর পর প্রদত্ত হোয়াটসএপ নাম্বারে প্যাকেজটির লিংক পাঠানো হবে।
        </p>
      </div>
    `;
    
    const dialog = document.createElement('dialog');
    dialog.className = 'scope-dialog';
    dialog.innerHTML = dialogContent;
    document.body.appendChild(dialog);
    dialog.showModal();
  };

  window.submitScopeRequest = async function() {
    const phone = document.getElementById('scope-phone').value.trim();
    const trxid = document.getElementById('scope-trxid').value.trim();
    const amount = document.getElementById('scope-amount').value;
    const service = "list";
    
    if (!phone || !trxid || !amount) {
      showMessage('Please fill all required fields', 'error');
      return;
    }
    
    if (!/^01[3-9]\d{8}$/.test(phone)) {
      showMessage('Invalid Bangladeshi phone number', 'error');
      return;
    }
    
    try {
      loadingOverlay.style.display = 'flex';
      
      const authToken = localStorage.getItem('authToken');
      const userID = localStorage.getItem('userID');
      
      if (!authToken || !userID) {
        throw new Error('Authentication required. Please login again.');
      }
      
      const response = await fetch('https://oneai-wjox.onrender.com/premium-payment', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
          'Authorization': `Bearer ${authToken}`,
          'X-User-ID': userID
        },
        body: JSON.stringify({ 
          phone,
          trxid,
          amount: parseFloat(amount),
          service,
          type: 'premium' 
        })
      });
      
    const data = await response.json();
    
    if (data.success) {
      document.querySelector('.scope-dialog').close();
      document.querySelector('.scope-dialog').remove();
      
      showMessage('Payment submitted! Redirecting...', 'success');
      setTimeout(() => window.location.href = 'dashboard.html', 2000);
    } else {
      throw new Error(data.message || 'Payment failed');
    }
  } catch (error) {
    showMessage(`Error: ${error.message}`, 'error');
  } finally {
    loadingOverlay.style.display = 'none';
  }
  };

    function showConfirmationDialog(phone, amount) {
        const confirmationContent = `
            <div class="confirmation-content">
                <h2><i class="fas fa-check-circle"></i> Payment Received</h2>
                <p>Your premium package payment of ${amount} BDT has been successfully submitted.</p>
                <p>The package details will be sent to ${phone} via WhatsApp after verification.</p>
                <button class="confirmation-ok" onclick="this.closest('dialog').close()">OK</button>
            </div>
        `;
        
        const dialog = document.createElement('dialog');
        dialog.className = 'confirmation-dialog';
        dialog.innerHTML = confirmationContent;
        document.body.appendChild(dialog);
        
        dialog.showModal();
        
        dialog.addEventListener('click', (e) => {
            if (e.target === dialog) {
                dialog.close();
                dialog.remove();
            }
        });
    };
  </script>
  <script src="./assets/js/load-navbar.js"></script>
  <script src="./assets/js/main.js"></script>
  <p>1Ai এর সাথেই থাকুন ওয়ানএআই আপনার ডিজিটাল সমস্যার স্মার্ট সমাধান।</p>
</body>
</html>
